YUI.add("geo",function(Y){"use strict";if(typeof YUI.Env.Geo==='undefined'){YUI.Env.Geo={};}
var eventName="geo:checked",JSONP_URL=nfl.constants.SITE_URL+"/widget/geocode?uri=/gamecenter/gamePass&callback=YUI.Env.Geo.nflGeoCallback",yLangisFunction=Y.Lang.isFunction,win=Y.config.win,onGeoResult=function(code,cb){if(yLangisFunction(cb)){cb(code);}},onGeoComplete=function(code){if(win.sessionStorage){try{win.sessionStorage.countryCode=code;}catch(e){}}
Y.Global.fire(eventName,code);},onIOComplete=function(id,xhr){var header=xhr.getResponseHeader("X-Akamai-Edgescape"),m=header&&header.match(/(?:^|;)country_code *= *(\w+)/i);onGeoComplete(m?m[1]:"US");},onJSONPComplete=function(data){onGeoComplete(data.countryCode||"US");};YUI.Env.Geo.nflGeoCallback=onJSONPComplete;Y.namespace("Geo").getCountryCode=function(cb){var yGlobal=Y.Global,loc=win.location,code;if(!yGlobal.getEvent(eventName,true)){yGlobal.publish(eventName,{fireOnce:true});code=win.sessionStorage&&win.sessionStorage.countryCode;if(code){onGeoComplete(code);}else if(nfl.constants.SITE_URL===loc.protocol+"//"+loc.host){Y.use("io-base",function(){Y.io("/",{method:"HEAD",on:{complete:onIOComplete}});});}else{Y.use("jsonp",function(){Y.jsonp(JSONP_URL,onJSONPComplete);});}}
yGlobal.on(eventName,onGeoResult,null,cb);};},"3.5.0",{requires:["event-custom"]});;YUI.add("scorestrip",function(Y){"use strict";var Constants=nfl.constants,YArray=Y.Array,YObject=Y.Object,YLang=Y.Lang,DIV="<div></div>",LINK="<a></a>",SPAN="<span></span>",toInt=function(value){return parseInt(value,10);},createNode=function(template,widget,className){var el=Y.Node.create(template||DIV);if(widget&&className&&YLang.isArray(className)){YArray.each(className,function(cn){el.addClass(widget.getClassName(cn));});}else if(widget&&className){el.addClass(widget.getClassName(className));}
return el;},reduceAttr=function(init,attr){init[attr]=this.get(attr);return init;},SCHEMAS={GAMES_SCHEMA:{metaFields:{bigPlayHighlights:{locator:"//gms/@bph",parser:toInt},week:{locator:"//gms/@w",parser:toInt},year:{locator:"//gms/@y",parser:toInt},seasonType:{locator:"//gms/@t",parser:function(value){return value==="R"?"REG":value==="P"?"PRE":value.toUpperCase();}},gameDay:{locator:"//gms/@gd",parser:function(value){return value&&value!=="0";}}},resultListLocator:"g",resultFields:[{key:"id",locator:"@eid",parser:function(value){return"game-"+value;}},{key:"gameId",locator:"@eid"},{key:"gsisKey",locator:"@gsis"},{key:"day",locator:"@d"},{key:"startTime",locator:"@t"},{key:"clockTime",locator:"@k"},{key:"quarter",locator:"@q"},{key:"homeTeamAbbr",locator:"@h"},{key:"homeTeamNickname",locator:"@hnn"},{key:"homeTeamScore",locator:"@hs",parser:toInt},{key:"visitorTeamAbbr",locator:"@v"},{key:"visitorTeamNickname",locator:"@vnn"},{key:"visitorTeamScore",locator:"@vs",parser:toInt},{key:"possessionTeam",locator:"@p"},{key:"inRedzone",locator:"@rz",parser:function(value){return value&&value!=="0";}},{key:"gameAlert",locator:"@ga"},{key:"network",locator:"@n"}]},BIG_PLAY_SCHEMA:{resultListLocator:'//bps/b',resultFields:[{key:"id",locator:"@id"},{key:"videoCMSID",locator:"@id",parser:function(){return"";}},{key:"gsisKey",locator:"@gsis"},{key:"gameId",locator:"@eid"},{key:"headline",locator:"@x"},{key:"team",locator:"@abbr"},{key:"bpType",locator:"@id",parser:function(){return"big-play";}}]},HIGHLIGHTS_SCHEMA:{resultListLocator:'//igh/h',resultFields:[{key:"id",locator:"@id"},{key:"videoCMSID",locator:"@id"},{key:"gsisKey",locator:"@gsis"},{key:"gameId",locator:"@eid"},{key:"pid",locator:"@pid"},{key:"headline",locator:"@d"},{key:"team",locator:"@abbr"},{key:"bpType",locator:"@type"}]}};Y.ScoreStripDATASCHEMAS=SCHEMAS;Y.ScoreStripEngine=(function(){var YDataSchemaXML=Y.DataSchema.XML,GlobalEnv=YUI.namespace("Env.ScoreStripEngine"),NAME="scorestrip-engine",GAMES_SCHEMA=SCHEMAS.GAMES_SCHEMA,BIG_PLAY_SCHEMA=SCHEMAS.BIG_PLAY_SCHEMA,HIGHLIGHTS_SCHEMA=SCHEMAS.HIGHLIGHTS_SCHEMA,ScoreStripEngine=function(){if(YLang.isUndefined(GlobalEnv.datasource)){ScoreStripEngine.superclass.constructor.apply(this,arguments);GlobalEnv.datasource=this;}
return GlobalEnv.datasource;};Y.extend(ScoreStripEngine,Y.Base,{initializer:function(){this._datasource=new Y.DataSource.IO();this._afterURLChange({newVal:this.get("url")});this._rConfig={callback:{success:Y.bind("_onSuccess",this),failure:Y.bind("_onFailure",this)}};this.publish(ScoreStripEngine.GC_VIDEO_ADDED,{emitFacade:true,broadcast:2});this.publish(ScoreStripEngine.UPDATE,{emitFacade:true,preventable:false,broadcast:2});this._displayedBigPlays={};this._games=[];this._timer=false;this._data="";this.after("pollingChange",this._afterPollingChange,this);this.after("urlChange",this._afterURLChange,this);this._afterPollingChange({newVal:this.get("polling")});this._afterURLChange({newVal:this.get("url")});},_afterURLChange:function(event){var aURL=event.newVal.split("?");this._datasource.set("source",aURL[0]);this._rVars=Y.QueryString.parse(aURL[1]||"");},_afterPollingChange:function(event){if(event.newVal){this.poll();}else if(this._timer){this._timer.cancel();this._timer=false;}},_onSuccess:function(event){var text=event.data.responseText,xml=event.data.responseXML,memo;if(this._data!==text){this._data=text;memo=this._updateNewGames(xml);if(memo){memo.bigPlays=this._getBigPlays(xml);this.fire(ScoreStripEngine.UPDATE,memo);}}
this.scheduleUpdate();},_getUpdatedGames:function(memo,game,index){var s=Y.JSON.stringify(game);if(game.homeTeamAbbr==="JAC"){game.homeTeamAbbr="JAX";}
if(game.visitorTeamAbbr==="JAC"){game.visitorTeamAbbr="JAX";}
memo.games.push(game);if(s!==this._games[index]){memo.updated.push(index);}
this._games[index]=s;return memo;},_updateNewGames:function(xml){try{var gmsNode=xml.getElementsByTagName('gms')[0],gmsAttributes=gmsNode.attributes,bph=gmsAttributes.getNamedItem("bph"),w=gmsAttributes.getNamedItem("w"),y=gmsAttributes.getNamedItem("y"),meta={bigPlayHighlights:(bph&&bph.value)||0,week:w&&w.value,year:y&&y.value,seasonType:GAMES_SCHEMA.metaFields.seasonType.parser(gmsAttributes.getNamedItem("t").value),gameDay:GAMES_SCHEMA.metaFields.gameDay.parser(gmsAttributes.getNamedItem("gd").value)},games=YDataSchemaXML.apply(GAMES_SCHEMA,xml),memo={meta:meta,updated:[],games:[]};}catch(err){console.error('scorestrip: '+err.message);return null;}
YArray.reduce(games.results,memo,this._getUpdatedGames,this);this._games.length=games.results.length;return memo;},_checkForNewBigPlays:function(bigPlay){var bpId=bigPlay.id;if(YLang.isUndefined(this.displayed[bpId])){this.display.push(bigPlay);if(bigPlay.bpType!=="big-play"){this.context.fire(ScoreStripEngine.GC_VIDEO_ADDED,bigPlay);}}
this.ignore[bpId]=true;},_getBigPlays:function(xml){var bigPlays=YDataSchemaXML.apply(BIG_PLAY_SCHEMA,xml).results,highlights=YDataSchemaXML.apply(HIGHLIGHTS_SCHEMA,xml).results,queue={displayed:this._displayedBigPlays,ignore:{},display:[],context:this};YArray.each(bigPlays,this._checkForNewBigPlays,queue);YArray.each(highlights,this._checkForNewBigPlays,queue);this._displayedBigPlays=queue.ignore;return queue.display;},_onFailure:function(response){Y.log("Scorestrip engine failure");Y.log(response);this.scheduleUpdate();},scheduleUpdate:function(){if(this.get("polling")){this._timer=Y.later(this.get("delay"),this,"poll");}},poll:function(){this._timer=false;this._rVars.random=String(new Date().getTime());this._rConfig.request="?"+Y.QueryString.stringify(this._rVars);this._datasource.sendRequest(this._rConfig);},start:function(){this.set("polling",true);},stop:function(){this.set("polling",false);},destructor:function(){this._datasource.destroy();if(this._timer){this._timer.cancel();}
this._bpTimer.cancel();this._datasource=this._rConfig=this._rVars=this._bigPlaysLookup=this._bigPlaysQueue=null;this._displayedBigPlays=this._games=this._timer=this._bpTimer=null;}},{GC_VIDEO_ADDED:"gamecenter:video:added",UPDATE:NAME+":update",NAME:NAME,SCHEMAS:{'GAMES_SCHEMA':GAMES_SCHEMA,'BIG_PLAY_SCHEMA':BIG_PLAY_SCHEMA},ATTRS:{delay:{value:nfl.constants.SS_DELAY||15*1000},url:{value:nfl.constants.SS_URL||nfl.constants.SITE_URL+'/liveupdate/scorestrip/ss.xml'},polling:{value:false,validator:YLang.isBoolean}}});return ScoreStripEngine;}());Y.SSBigPlayHiglightNotifier=(function(){var BPH_ATTRS=["count","heading","description"];return Y.Base.create("scorestrip-bph",Y.Widget,[],{CONTENT_TEMPLATE:LINK,_setCount:function(value){var max=this.get("maxCount"),val=Math.round(Number(value));return isNaN(val)?Y.Attribute.INVALID_VALUE:(val>max)?max:val;},renderUI:function(){var close=createNode(LINK,this,"close").setAttribute("href","#").setAttribute("title","Close").setAttribute("data-clickname","Scores_BigPlay_ScoreStrip"),heading=createNode(SPAN,this,"heading"),count=createNode(SPAN,this,"count"),desc=createNode(SPAN,this,"description"),sponsor=createNode(SPAN,this,"sponsor");this.get("contentBox").append(Y.all([heading,count,desc,sponsor])).setAttribute("target","_top");this.get("boundingBox").append(close);this._count=count;this._heading=heading;this._description=desc;this._sponsor=sponsor;this._close=close;},_onCloseClick:function(){this.set("visible",false);},_afterAttrChange:function(event,node){node.setContent(event.newVal);},_afterURLChange:function(event){this.get("contentBox").set("href",event.newVal);},_afterSponsorChange:function(event){if(event.newVal){this._sponsor.setStyle("backgroundImage",event.newVal?"url(\""+event.newVal+"\")":null);}},_nfl_afterVisibleChange:function(event){var img;if(event.newVal&&this.get("sponsorPixel")){img=new Image();img.src=this.get("sponsorPixel")+String(new Date().getTime());}
if(window.Modernizr&&!window.Modernizr.csstransitions){this.get("boundingBox").transition(event.newVal?this._visibleStyles:this._hiddenStyles);}},bindUI:function(){Y.Array.each(BPH_ATTRS,function(attr){this.after(attr+"Change",this._afterAttrChange,this,this["_"+attr]);},this);this.after("urlChange",this._afterURLChange,this);this.after("sponsorChange",this._afterSponsorChange,this);this.after("visibleChange",this._nfl_afterVisibleChange,this);this._closeHandler=this._close.on("click",this._onCloseClick,this);},syncUI:function(){var bbx;Y.Array.each(BPH_ATTRS,function(attr){this._afterAttrChange({newVal:this.get(attr)},this["_"+attr]);},this);this._afterURLChange({newVal:this.get("url")});this._afterSponsorChange({newVal:this.get("sponsor")});if(window.Modernizr&&!window.Modernizr.csstransitions){bbx=this.get("boundingBox");this._visibleStyles={right:"0px",opacity:1};this._hiddenStyles={right:-1*bbx.get("offsetWidth")+"px",opacity:0};if(!this.get("visible")){bbx.setStyles(this._hiddenStyles);}}},destructor:function(){if(this.get("rendered")){this._closeHandler.detach();this._closeHandler=this._close=this._heading=this._count=this._description=this._sponsor=null;}}},{ATTRS:{url:{value:Constants.SITE_URL+"/scores"},heading:{value:"Big Play Highlight"},description:{value:"Big Play Highlight videos available. WATCH NOW"},count:{value:0,setter:"_setCount"},maxCount:{value:999},sponsorPixel:{value:nfl.constants.SS_CONF.trackingSponPixel},sponsor:{value:nfl.constants.SS_CONF.sponsorLogo?nfl.constants.SS_CONF.sponsorLogo:Y.config.groups.nfl.base+"scorestrip/assets/skins/sam/mcd.png"}}});}());Y.SSTile=(function(){var URL_ATTRS=["gameId","year","seasonType","week","visitorTeamNickname","homeTeamNickname","campaignCode","hashCode"],BULK_ATTRS={gameId:true,gsisKey:true,day:true,year:true,seasonType:true,week:true,startTime:true,clockTime:true,quarter:true,possessionTeam:true,homeTeamAbbr:true,homeTeamNickname:true,homeTeamScore:true,visitorTeamAbbr:true,visitorTeamNickname:true,visitorTeamScore:true,inRedzone:true,gameAlert:true,isInternational:false};return Y.Base.create("scorestrip-tile",Y.Widget,[Y.WidgetChild],{URL_TEMPLATE:Constants.SITE_URL+"/gamecenter/{gameId}/{year}/{seasonType}{week}/{visitorTeamNickname}@{homeTeamNickname}",WATCH_URL:Constants.SITE_URL+"/gamecenter/{gameId}/{year}/{seasonType}{week}/{visitorTeamNickname}@{homeTeamNickname}{campaignCode}{hashCode}",OMNITURE_TEMPLATE:"ss-tile {index}-{visitorTeamNickname}@{homeTeamNickname}",OMNITURE_TEMPLATE_INTERNATIONAL:"ss-tile {index}-gp_watch",BOUNDING_TEMPLATE:"<li></li>",CONTENT_TEMPLATE:"<div></div>",initializer:function(){this._rzClass=this.getClassName("redzone");},_getInGame:function(){switch(this.get('quarter')){case"P":case"F":case"FO":return false;}
return true;},_getClock:function(){var q=this.get('quarter');switch(q.toUpperCase()){case"P":return this.get('day')+' '+this.get('startTime');case"1":case"2":case"3":case"4":return'Q'+q+' '+this.get('clockTime');case"H":return'HALF';case"F":return'FINAL';case"FO":return"FINAL OT";case"SUSPENDED":return"SUSP";}
return"OT "+this.get('clockTime');},_getURL:function(){return Y.substitute(this.URL_TEMPLATE,YArray.reduce(URL_ATTRS,{},reduceAttr,this));},_getWatchURL:function(){return Y.substitute(this.WATCH_URL,YArray.reduce(URL_ATTRS,{},reduceAttr,this));},_getPossession:function(){return this.get("possessionTeam")===this.get('homeTeamAbbr')?'home':'visitor';},renderUI:function(){try{var cb=this.get('contentBox');var _l1=createNode(LINK,this,"game-link");var _l2=createNode('<a>WATCH</a>',this,"watch-link");cb.append(Y.all([_l1,_l2]));var vts=createNode(SPAN,this,["vts","visitor","score"]),vta=createNode(SPAN,this,["vta","visitor","abbr"]),hts=createNode(SPAN,this,["hts","home","score"]),hta=createNode(SPAN,this,["hta","home","abbr"]),pos=createNode(SPAN,this,"possession"),clock=createNode(SPAN,this,"clock"),alert=createNode(SPAN,this,["alert-box"]),target=this.get("target");_l1.set("target",target).append(Y.all([vts,vta,hts,hta,pos,clock,alert]));this._gameLink=_l1;this._watchLink=_l2;this._visitorTeamScore=vts;this._visitorTeamAbbr=vta;this._homeTeamScore=hts;this._homeTeamAbbr=hta;this._possession=pos;this._clock=clock;this._alert=alert;}catch(e){console.error('renderUI Error: ',e);}},_afterStateChange:function(event,prefix){var cb=this.get('contentBox');if(!prefix){prefix="";}
cb.removeClass(this.getClassName((prefix+event.prevVal).toLowerCase()));cb.addClass(this.getClassName((prefix+event.newVal).toLowerCase()));},_afterQuarterChange:function(event){this._afterStateChange(event);this._afterClockComponentChange();this.get("boundingBox")[this.get("inGame")?"addClass":"removeClass"](this.getClassName("ingame"));this._calcWinner();},_calcWinner:function(){var bb=this.get('boundingBox'),hts=this.get("homeTeamScore"),vts=this.get("visitorTeamScore"),q=this.get("quarter"),hClass=this.getClassName("home-wins"),vClass=this.getClassName("visitor-wins"),fClass=this.getClassName("final");bb.removeClass(hClass);bb.removeClass(vClass);bb.removeClass(fClass);if(q==="F"||q==="FO"){bb.addClass(fClass);if(hts>=vts){bb.addClass(hClass);}
if(hts<=vts){bb.addClass(vClass);}}},_toggleStateEvent:function(event){this.get("boundingBox")[event.newVal?"addClass":"removeClass"](this.getClassName(event.attrName.toLowerCase()));},_afterGameAlertChange:function(event){var bbx=this.get("boundingBox"),aClass=this.getClassName("alert"),alert=event.newVal;this._alert.setContent(alert);if(alert){bbx.addClass(aClass);}else{bbx.removeClass(aClass);}},_updateURL:function(){var url,watchUrl;if(!this.get('visitorTeamNickname')||!this.get('homeTeamNickname')){url=watchUrl='/scores';}else{url=this.get("url");watchUrl=this._getWatchURL();}
this.get("contentBox").set("href",url);if(!this._gameLink){this._gameLink=this.get("contentBox").one('.'+this.getClassName("game-link"));}
if(!this._watchLink){this._watchLink=this.get("contentBox").one('.'+this.getClassName("watch-link"));}
if(this._gameLink){this._gameLink.set("href",url);}
if(this._watchLink){this._watchLink.set("href",watchUrl);}
this._urlInterval=false;},_afterCampaignCodeChange:function(event){this._updateURL();},_afterHashCodeChange:function(event){},_afterIsInternationalChange:function(event){this.get("boundingBox")[(event.newVal)?"addClass":"removeClass"](this.getClassName("international"));this.set("hashCode",((event.newVal)?"#menu=gamepass":""));this.set("campaignCode",((event.newVal)?"?icampaign=GamePass_ScoreStrip_watch":""));},_afterURLComponentChange:function(){if(!this._urlInterval){this._urlInterval=Y.later(100,this,"_updateURL");}},_updateClock:function(){this._clock.setContent(this.get("clock"));this._clockInterval=false;},_afterClockComponentChange:function(){if(!this._clockInterval){this._clockInterval=Y.later(100,this,"_updateClock");}},_afterPossessionTeamChange:function(){var possession=this.get("possession");this._afterStateChange({newVal:possession,prevVal:possession==="home"?"visitor":"home"},"possession");},_afterStandardAttrChange:function(event,node){node.setContent(event.newVal);},_afterDayChange:function(event){this._afterURLComponentChange(event);this._afterClockComponentChange(event);},_afterIndexChange:function(event){var bbx=this.get("boundingBox"),pv=event.prevVal,nv=event.newVal;if(event.type.indexOf("parentChange")>-1){pv=-1;nv=this.get("index");}
bbx.removeClass(this.getClassName("index",String(pv)));bbx.addClass(this.getClassName("index",String(nv)));},_afterScoreChange:function(event,node){this._afterStandardAttrChange(event,node);this._calcWinner();},_onWatchClick:function(event){if(!this.get('isInternational')){return;}
event.stopPropagation();var PRODUCT_CONF={landing:'https://gamepass.nfl.com/nflgp/secure/packages?icampaign=GP_GC_packages',app:{url:'http://gamepass.nfl.com/nflgp/console.jsp?icampaign=GP_GC_console',name:'nflgpconsole',width:'968',height:'668'}}
if(PRODUCT_CONF.app.url!=null){var u=PRODUCT_CONF.app.url;var elias=this.get('gameId'),pre=u.indexOf('?')!=-1?'&':'?';if(elias!=null)
{u+=pre+'eid='+elias;}
var win=window.open(u,PRODUCT_CONF.app.name,'scrollbars=yes,menubar=no,height='+PRODUCT_CONF.app.height+',width='+PRODUCT_CONF.app.width+',top=0,left=0,resizable=no,toolbar=no,location=no,status=no');if(win!=null){win.focus();}}
Y.substitute(this.OMNITURE_TEMPLATE_INTERNATIONAL,{index:this.get('index')});var eVar12=Y.substitute(this.OMNITURE_TEMPLATE_INTERNATIONAL,{index:this.get('index'),visitorTeamNickname:this.get('visitorTeamNickname'),homeTeamNickname:this.get('homeTeamNickname')});s_analytics.linkTrackVars="events,eVar12";s_analytics.linkTrackEvent="event50";s_analytics.events="event50";s_analytics.eVar12=eVar12;s_analytics.tl(this,'o',s_analytics.eVar12);},_onClick:function(event){var eVar12=Y.substitute((this.get('isInternational')?this.OMNITURE_TEMPLATE_INTERNATIONAL:this.OMNITURE_TEMPLATE),{index:this.get('index'),visitorTeamNickname:this.get('visitorTeamNickname'),homeTeamNickname:this.get('homeTeamNickname')});s_analytics.linkTrackVars="events,eVar12";s_analytics.linkTrackEvent="event50";s_analytics.events="event50";s_analytics.eVar12=eVar12;s_analytics.tl(this,'o',s_analytics.eVar12);},bindUI:function(){this.after("gameIdChange",this._afterURLComponentChange,this);this.after("yearChange",this._afterURLComponentChange,this);this.after("seasonTypeChange",this._afterURLComponentChange,this);this.after("weekChange",this._afterURLComponentChange,this);this.after("homeTeamNicknameChange",this._afterURLComponentChange,this);this.after("visitorTeamNicknameChange",this._afterURLComponentChange,this);this.after("startTimeChange",this._afterClockComponentChange,this);this.after("clockTimeChange",this._afterClockComponentChange,this);this.after("dayChange",this._afterDayChange,this);this.after("quarterChange",this._afterQuarterChange,this);this.after("possessionTeamChange",this._afterPossessionTeamChange,this);this.after("homeTeamAbbrChange",this._afterStandardAttrChange,this,this._homeTeamAbbr);this.after("visitorTeamAbbrChange",this._afterStandardAttrChange,this,this._visitorTeamAbbr);this.after("homeTeamScoreChange",this._afterScoreChange,this,this._homeTeamScore);this.after("visitorTeamScoreChange",this._afterScoreChange,this,this._visitorTeamScore);this.after("inRedzoneChange",this._toggleStateEvent,this);this.after("bigPlayChange",this._toggleStateEvent,this);this.after("indexChange",this._afterIndexChange,this);this.after("parentChange",this._afterIndexChange,this);this.after("gameAlertChange",this._afterGameAlertChange);this.after("isInternationalChange",this._afterIsInternationalChange,this);this.after("campaignCodeChange",this._afterCampaignCodeChange,this);this.after("hashCodeChange",this._afterHashCodeChange,this);this._watchHandler=this.get('contentBox').one('.yui3-scorestrip-tile-watch-link').on('click',this._onWatchClick,this);this._clickHandler=this.get('contentBox').one('.yui3-scorestrip-tile-game-link').on('click',this._onClick,this);},syncUI:function(){var possession=this.get("possession");this._afterQuarterChange({newVal:this.get("quarter")});this._afterStateChange({newVal:possession,prevVal:possession==="home"?"visitor":"home"},"possession");this._afterStandardAttrChange({newVal:this.get("homeTeamAbbr"),attrName:"homeTeamAbbr"},this._homeTeamAbbr);this._afterStandardAttrChange({newVal:this.get("visitorTeamAbbr"),attrName:"visitorTeamAbbr"},this._visitorTeamAbbr);this._afterStandardAttrChange({newVal:this.get("homeTeamScore"),attrName:"homeTeamScore"},this._homeTeamScore);this._afterStandardAttrChange({newVal:this.get("visitorTeamScore"),attrName:"visitorTeamScore"},this._visitorTeamScore);this._toggleStateEvent({newVal:this.get("inRedzone"),attrName:"inRedzone"});this._toggleStateEvent({newVal:this.get("bigPlay"),attrName:"bigPlay"});this._afterIndexChange({newVal:this.get("index"),type:"indexChange",prevVal:-1});this._afterGameAlertChange({newVal:this.get("gameAlert")});this._afterIsInternationalChange({newVal:this.get('isInternational')});this._updateClock();this._updateURL();},_tile_updateAttr:function(value,key){if(BULK_ATTRS[key]&&value!==this.get(key)){this.set(key,value);}},updateTileAttrs:function(values){YObject.each(values,this._tile_updateAttr,this);},destructor:function(){this._visitorTeamScore=this._visitorTeamAbbr=this._homeTeamScore=this._homeTeamAbbr=this._possession=this._clock=this._alert=null;if(this._clickHandler)this._clickHandler.detach();if(this._watchHandler)this._watchHandler.detach();}},{ATTRS:{gameId:{value:""},gsisKey:{value:""},day:{value:""},clock:{getter:"_getClock",readOnly:true},year:{value:""},seasonType:{value:""},week:{value:""},startTime:{value:""},clockTime:{value:""},quarter:{value:""},possession:{value:"home",getter:"_getPossession",readOnly:true},possessionTeam:{value:""},homeTeamAbbr:{value:""},homeTeamNickname:{value:""},homeTeamScore:{value:0},visitorTeamAbbr:{value:""},visitorTeamNickname:{value:""},visitorTeamScore:{value:0},url:{getter:'_getURL',readyOnly:true},inGame:{getter:'_getInGame',readOnly:true},inRedzone:{value:false},gameAlert:{value:""},bigPlay:{value:false},isInternational:{value:false},campaignCode:{value:''},hashCode:{value:''},target:{value:"_top",validator:YLang.isString}}});}());Y.SSNotifier=(function(){return Y.Base.create("scorestrip-notifier",Y.Widget,[],{initializer:function(){},BGIMAGE_TEMPLATE:"url(\""+nfl.constants.IMAGE_PATH+"/img/logos/20x20/{newVal}.png\")",renderUI:function(){var cb=this.get("contentBox"),title=createNode(SPAN,this,"title"),headline=createNode(SPAN,this,"headline"),link=createNode(LINK).setAttribute("target","_top");cb.append(link.append(Y.all([title,headline])));this._title=title;this._headline=headline;this._link=link;},_afterVideoCMDSIDChange:function(event){this._title.setContent(event.newVal?"Highlight Alert:":"Big Play Alert:");},_afterHeadlineChange:function(event){this._headline.setContent(event.newVal);},_afterURLChange:function(event){this._link.setAttribute("href",event.newVal);},_toggleState:function(event,state){var bbx=this.get("boundingBox");bbx.removeClass(this.getClassName(state,event.prevVal));bbx.addClass(this.getClassName(state,event.newVal));},_afterOpenedChange:function(event){this.get("contentBox").transition(event.newVal?this._openedStyles:this._closedStyles);},_afterTeamChange:function(event){this._link.setStyle("backgroundImage",event.newVal?Y.substitute(this.BGIMAGE_TEMPLATE,event):null);},bindUI:function(){this.after("videoCMSIDChange",this._afterVideoCMDSIDChange,this);this.after("headlineChange",this._afterHeadlineChange,this);this.after("urlChange",this._afterURLChange,this);this.after("teamChange",this._afterTeamChange,this);this.after("alignChange",this._toggleState,this,"align");},syncUI:function(){var cbx;this._afterVideoCMDSIDChange({newVal:this.get("videoCMSID")});this._afterHeadlineChange({newVal:this.get("headline")});this._afterURLChange({newVal:this.get("url")});this._toggleState({newVal:this.get("align")},"align");this._afterTeamChange({newVal:this.get("team")});this.get("boundingBox").addClass(this.getClassName("rendered"));if(window.Modernizr&&!window.Modernizr.csstransitions){this.after("visibleChange",this._afterOpenedChange,this);cbx=this.get("contentBox");this._openedStyles={width:cbx.get("offsetWidth")};this._closedStyles={width:0};cbx.setStyles(this.get("visible")?this._openedStyles:this._closedStyles);}},destructor:function(){this._title=this._headline=this._link=null;}},{ATTRS:{align:{value:"left",validator:function(value){return value==="left"||value==="right";}},videoCMSID:{value:""},team:{value:""},title:{value:""},headline:{value:"",setter:function(value){return(value.length>52)?value.substring(0,52)+"\u2026":value;}},url:{value:"#"},index:{value:-1}}});}());Y.ScoreStrip=(function(){var BP_INTERVAL=10*1000,BPH_DISPLAY_TIME=10*1000,EVERY_MINUTE=60*1000;return Y.Base.create("scorestrip",Y.Widget,[Y.WidgetParent],{CONTENT_TEMPLATE:"<ol></ol>",QUEUE_MAX:5,HALFWAY_POINT:7,INTERNATIONAL:false,COUNTRYCODE:null,initializer:function(){this._bigPlaysQueue=[];this._bphCount=0;this._bbxy=-1;Y.Geo.getCountryCode(Y.bind("_onGeoResponse",this));},start:function(){this._engine.start();},stop:function(){this._engine.stop();},renderUI:function(){var bbx=this.get('boundingBox'),container,firstInGameTile,scrollLeft;this._notifier=new Y.SSNotifier({render:bbx,visible:false});this._bpn=new Y.SSBigPlayHiglightNotifier({visible:false,render:bbx});Y.on('contentready',function(){firstInGameTile=Y.one('.yui3-scorestrip-tile-ingame');if(firstInGameTile&&nfl.constants.IS_MOBILE){scrollLeft=firstInGameTile.getX();container=Y.one('#scorestrip')||Y.one('#hdscorestripContainer');if(container){Y.use('anim',function(){var anim=new Y.Anim({node:container,to:{scrollLeft:scrollLeft}});anim.run();});}}},'.yui3-scorestrip-content .yui3-scorestrip-tile');},_onGeoResponse:function(code){if(nfl.constants.ENV==='DEV'){code='MX';}
this.COUNTRYCODE=code;this.INTERNATIONAL=(Y.Array.indexOf(['US','MX'],this.COUNTRYCODE)>-1)?false:true;this.each(function(_child){_child.set('isInternational',this.INTERNATIONAL);},this);},_onUpdate:function(event){this._doUpdate(event,event.games.length,event.updated.length);},_doUpdate:function(event,count,updatedCount){var i=0,j,s=this.size(),newQueue=this._bigPlaysQueue.concat(event.bigPlays),targetValue=this.get('target');this._bphCount=event.meta.bigPlayHighlights;this._bpn.set("count",this._bphCount);if(!event.meta.gameDay){Y.log("Not game day, setting delay to 5 min");this._engine.set("delay",5*60*1000);this._bphTimer.cancel();this._bpnTimer.cancel();}
for(i;i<s&&i<updatedCount;i+=1){j=event.updated[i];if(this.item(j))this.item(j).setAttrs(Y.merge(event.meta,event.games[j]));}
while((s=this.size())<count){this.add(new Y.SSTile(Y.merge(event.meta,event.games[s],{target:targetValue,isInternational:this.INTERNATIONAL})));}
while((s=this.size())>count){this.remove(count).destroy();}
while(newQueue.length>this.QUEUE_MAX){newQueue.shift();}
this._bigPlaysQueue=newQueue;},_afterPollingChange:function(event){this.get("engine")[event.newVal?"start":"stop"]();},_isInGame:function(game){return game.get("inGame");},_showBigPlayHighlights:function(){if(nfl.constants.IS_MOBILE){return;}
var img;if(this._bphCount>0&&(new Date().getMinutes()%10)===0&&this.some(this._isInGame)){img=new Image();this._bpn.show();Y.later(BPH_DISPLAY_TIME,this._bpn,"hide");}},_showBigPlays:function(){if(nfl.constants.IS_MOBILE){return;}
var bp,game,align,index,x,gbbx;if(this._showingBP){this._showingBP=false;this._notifier.set("visible",false);game=this.item(this._notifier.get("index"));if(game){game.set("bigPlay",false);}}else if(this._bigPlaysQueue.length){bp=this._bigPlaysQueue.shift();this.each(function(g){if(YLang.isUndefined(game)&&bp.gsisKey===g.get("gsisKey")){game=g;}});if(YLang.isUndefined(game)){return;}
index=game.get("index");align=index>this.HALFWAY_POINT?"right":"left";gbbx=game.get("boundingBox");x=gbbx.getX();if(align==="left"){x+=gbbx.get("offsetWidth");}
game.set("bigPlay",true);this._showingBP=true;this._notifier.get("boundingBox").setX(x);this._notifier.setAttrs(Y.merge(bp,{index:index,visible:true,align:align,url:game.get("url")}));}},bindUI:function(){var engine=new Y.ScoreStripEngine({url:this.get("url"),polling:this.get("polling")});this._engine=engine;this._updateHandler=engine.after(Y.ScoreStripEngine.UPDATE,this._onUpdate,this);this.after("pollingChange",this._afterPollingChange,this);this._bphTimer=Y.later(EVERY_MINUTE,this,"_showBigPlayHighlights",null,true);this._showBigPlayHighlights();this._bpnTimer=Y.later(BP_INTERVAL,this,"_showBigPlays",null,true);},syncUI:function(){this._bbxy=this.get("boundingBox").getY();this._fixedClass=this.getClassName("fixed");this._fixed=false;this._showingBP=false;},destructor:function(){if(this.get("rendered")){this._updateHandler.detach();this._scrollHandler=this._updateHandler=null;this._engine=null;this._notifier.destroy();this._bpn.destroy();this._bphTimer.cancel();this._bpnTimer.cancel();this._bphTimer=this._bpnTimer=null;this._notifier=this._bpn=null;}}},{ATTRS:{bpInterval:{value:10*1000,writeOnce:true},url:{value:nfl.constants.SS_URL||nfl.constants.SITE_URL+'/liveupdate/scorestrip/ss.xml'},polling:{value:true},defaultChildType:{value:"SSTile"},target:{value:"_top",validator:YLang.isString}}});}());},"3.3.0",{requires:["base-build","node-base","node-screen","widget","widget-parent","widget-child","geo","substitute","array-extras","transition","datasource-io","dataschema-xml","datatype-xml-parse","querystring","json-stringify","font-endzonetech-bold"],skinnable:true,group:"nfl"});